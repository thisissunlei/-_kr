<!--index.wxml-->
<!-- 生成二维码 -->
<import src="../../utils/template/template.wxml"/>
<wxs module="filter">
  var filter = {
  subPrice: function (value) {
  console.log('value', value)
  if (value > 1) {
  return value;
  } else {
  return value.substring(2)
  }
  }
  };

  module.exports = {
  subPrice: filter.subPrice
  };
</wxs>

<view class="bargain-details {{canShow ? '' : 'notShow'}}" wx:if="{{activityFlag}}">
  <view class="bg">
    <image src="{{KrImgUrl}}/bargainActivity/page_bg2.png"></image>
  </view>
  <view class="bargain-rule-text" bindtap="helpingRule">活动规则</view>
  <!--<view class="know-kr-wrap">-->
  <!--<image src="{{KrImgUrl}}/bargainActivity/know.png"></image>-->
  <!--<text>了解氪空间</text>-->
  <!--</view>-->

  <view class="bargain-main" >
    <view>
      <view class="bargain-content">
        <view class="avatar">
          <image src="{{originInfo.avatarUrl}}"></image>
        </view>
        <view class="content-name">
          {{originInfo.nickName}}
        </view>
        <view class="ad">
          <image class="quoat-left" src="{{KrImgUrl}}/bargainActivity/quoat.png"></image>
          <view class="ad-text">我想去氪空间办公，快补刀帮我
            砍价吧！
          </view>
          <image class="quoat-right" src="{{KrImgUrl}}/bargainActivity/quoat.png"></image>
        </view>
        <view class="know-kr" bindtap="goKrSpace">
          了解氪空间
        </view>
        <view class="cut-text {{disInfo.hasHelpDis && !disInfo.hasUsed ? 'has-help' : ''}} {{disInfo.hasUsed ? 'has-used': ''}} {{canShowBtn ? '' : 'notShow'}}"
              bindtap="selfReduce">
          {{disInfo.hasUsed ? '砍价结束啦' : (disInfo.hasHelpDis ? ('已帮砍' + disInfo.deductAmount + '折') : '是朋友就补他一刀')}}
        </view>
        <view class="content-dis">
          <view>当前折扣
            <text class="current-dis">{{disInfo.current}}</text>
            折
          </view>
        </view>
        <!--<view class="dis-num" wx:if="{{disInfo.hasDis}}">-->
        <view class="dis-num">
          <view class="dis-num-text" style="left:{{(disInfo.disNum/5*520-70) > (520 - 70) ? 520 : (disInfo.disNum/5*520-70)}}rpx">已砍{{disInfo.disNum}}折</view>
        </view>
        <view class="content-pro-wrap">
          <view class="content-pro" style="width:{{disInfo.disNum / 5 * 520}}rpx; max-width: 100%"></view>
          <image src="{{KrImgUrl}}/bargainActivity/gold.png" class="gold-image"
                 style="left:{{disInfo.disNum/5 * 520-30}}rpx"></image>
        </view>
        <view class="content-text mb0">
          <text>标准价</text>
          <text>5折</text>
        </view>
      </view>
    </view>
  </view>

  <view class="btn-box out-box" wx:if="{{disInfo.hasHelpDis}}">
    <view class="self-cut" bindtap="goCoupon">查看礼品券</view>
    <view class="call" bindtap="goBargain">我也发起砍价</view>
    <image class="bubble" src="{{KrImgUrl}}/bargainActivity/bubble.png"></image>
  </view>

  <view class="record-content">
    <view class="record-top">
      <text>好友助力</text>
      <view class="left-circle"></view>
      <view class="right-circle"></view>
    </view>
    <view class="record-list" wx:if="{{recordList && recordList.length}}">
      <view class="record-list-content">
        <view class="friend-num">
          已有{{totalCount}}个好友帮砍
        </view>
        <view class="record-list-friend" wx:for="{{recordList}}" wx:key>
          <view class="friend-list-left">
            <view class="friend-list-avatar">
              <image src="{{item.helpThirdAvatar}}"></image>
            </view>
            <view class="friend-list-name">
              <view class="friend-list-thirdNick">{{item.helpThirdNick}}</view>
              <view class="friend-list-text">{{item.ctime}}</view>
            </view>
          </view>
          <view class="friend-list-right">
            <view class="friend-list-value">
              <view class="list-value-img">
                <image src="{{KrImgUrl}}/bargainActivity/icon_gold.png"></image>
              </view>
              <view class="list-value-count">
                砍掉 {{item.amount > 1 ? '' : '0.'}}
                <text class="item-dis">{{(filter.subPrice(('' + item.amount)))}}</text>
                折
              </view>
            </view>
          </view>
        </view>
        <view class="friend-list-more" wx:if="{{totalCount > 10 && totalPages > recordParams.page}}">上滑加载更多</view>
      </view>
    </view>
    <!-- 缺省 -->
    <view class="record-none">
      <view class="record-none-text has-record-text">
        <text>人多力量大，快喊小伙伴来助力吧~</text>
      </view>
    </view>
  </view>

</view>

<!-- 活动规则 -->
<view class="bargain-rule" wx:if="{{showRule}}">
  <view class="rule-content">
    <view class="rule-top">
      <view>
        <view class="rule-one">活动规则</view>
      </view>
      <view></view>
    </view>
    <view class="rule-scoll">
      <view>1）可以通过分享活动至微信群、朋友圈的方式主动发起活动；</view>
      <view>2）每个好友助力，可砍
        <text class="size">0.08-0.2</text>
        折；
      </view>
      <view>3）为好友助力后，你也可获得
        <text class="size">10-20</text>
        元礼券；
      </view>
      <view>4）如下社区不支持该活动：朝阳公园社区；</view>
      <view>5）砍价结束后，可再次发起砍价，但已助力过的朋友不能再次助力；
        <!-- <text class="size">999</text> -->
      </view>
      <view>6）仅限新人用户参与活动；
        <!-- <text class="size">closeRule3</text> -->
      </view>
      <view>7）如有疑问请联系客服，活动最终解释权归氪空间所有；</view>
    </view>
    <view class="rule-text" bindtap="closeRule">
      <image src="../images/public/error.png"></image>
    </view>
  </view>
</view>


<!-- 帮忙砍价成功 -->
<view class="bargainDialog" wx:if="{{helpSuccess}}">
  <view class="content-box">
    <view class="text self-text">你已成功帮</view>
    <view class="dialog-avatar-wrap">
      <image class="dialog-avatar" src="{{originInfo.avatarUrl}}"></image>
      <image class="crown" src="{{KrImgUrl}}/bargainActivity/crown.png"></image>
    </view>
    <view class="dialog-name">
      {{originInfo.nickName}}
    </view>
    <view class="text">
      <text class="desc-text">砍掉了</text>
      <text class="self-dis">{{disInfo.deductAmount}}</text>
      <text class="self-dis-text">折</text>
      <image class="dialog-star" src="{{KrImgUrl}}/bargainActivity/star.png"></image>
    </view>
    <image class="close-button" src="{{KrImgUrl}}helpingActivity/share/close.png" bindtap="closeDialog"></image>

    <view class="text dis-text">你也获得了一张50元礼品券已存入账户中</view>
    <view class="btn-box">
      <view class="call" bindtap="goCoupon">查看礼品券</view>
      <view class="self-cut" bindtap="goBargain">我也发起砍价</view>
    </view>
  </view>
</view>

<!-- 已经帮砍过 -->
<view class="hasHelpDialog" wx:if="{{hasHelpSuccess}}">
  <view class="content-box">
    <image class="has-help-img" src="{{KrImgUrl}}/bargainActivity/gift.png"></image>
    <image class="close-button" src="{{KrImgUrl}}helpingActivity/share/close.png" bindtap="closeDialog"></image>
  </view>
</view>

<!-- 分享朋友圈 -->
<view class="share-fixed" wx:if="{{showShareFriend}}">
  <view class="share-bg-top" bindtap="shareView"></view>
  <view class="share-bg-bottom">
    <text class="share-bg-title">分享至</text>
    <view class="share-bg-btn">
      <view class="left">
        <button class="wxfriend" id="all-friend" open-type="share">
          <image src="{{KrImgUrl}}helpingActivity/details/wxfriend.png"></image>
        </button>
        <text>微信好友</text>
      </view>
      <view class="right">
        <button class="wxfriend" id="share-friend" bindtap="createShareCanvas">
          <image src="{{KrImgUrl}}helpingActivity/details/wxcricle.png"></image>
        </button>
        <text>朋友圈</text>
      </view>
    </view>
  </view>
</view>

<!-- 生成的海报 -->
<view class="shareDialog" wx:if="{{showShare}}">

  <view class="content-box">
    <image class="close-button" src="{{KrImgUrl}}helpingActivity/share/close.png" bindtap="closeDialog"></image>
    <view class="text">请保存图片至手机相册并</view>
    <view class="text">分享到朋友圈</view>
    <image src="{{imgUrl}}" alt="" class="canvas-show"></image>
    <image class="save" src="{{KrImgUrl}}helpingActivity/share/save_button.png" bindtap="saveImg"></image>
  </view>

</view>
<!-- 海报生成成功 -->
<view class="successDialog" wx:if="{{showSuccess}}">

  <view class="content-box">
    <image class="close-button" src="{{KrImgUrl}}helpingActivity/share/close.png" bindtap="closeDialog"></image>
    <view class="text">图片已保存到您手机相册，</view>
    <view class="text">赶快去朋友圈召唤好友助力吧！</view>
    <image src="{{KrImgUrl}}helpingActivity/share/default.png" alt="" class="default-img"></image>
    <image class="save" src="{{KrImgUrl}}helpingActivity/share/share_know.png" bindtap="closeDialog"></image>
  </view>

</view>
<view wx:if="{{!activityFlag}}" class="container">
  <view class="header">
    <image class="default-img" src="{{KrImgUrl}}helpingActivity/helping/none.png"></image>
  </view>
  <view class="content">
    很抱歉，活动已经结束了呢~
  </view>
  <view class="go-back" bindtap="goToHome">
    <text class="go-back-content">去自由座首页看看</text>
    <image class="go-back-button" src="{{KrImgUrl}}helpingActivity/details/button_goindex.png">

    </image>
  </view>
</view>
<!--<button wx:if="{{!hasUserInfo && activityFlag && hasLoadUserInfo}}" catchtouchmove="ture" open-type="getUserInfo"-->
        <!--lang="zh_CN"-->
        <!--bindgetuserinfo="onGotUserInfo"-->
        <!--style="position:fixed;left:0;top:0;bottom:0;right:0;opacity:0;z-index: 9999;"></button>-->
<!--<view wx:if="{{!hasUserInfo && activityFlag && hasLoadUserInfo}}" class="masking-out" catchtouchmove="ture">-->
  <!--<image class="masking-img" src="{{KrImgUrl}}helpingActivity/index/prompt.png"></image>-->
<!--</view>-->
<button wx:if="{{!hasUserInfo && activityFlag && hasLoadUserInfo}}" catchtouchmove="ture" open-type="getUserInfo"
        lang="zh_CN"
        bindgetuserinfo="onGotUserInfo"
        style="position:fixed;left:0;top:0;bottom:0;right:0;opacity:0;z-index: 9999;"></button>
<view wx:if="{{!hasUserInfo && activityFlag && hasLoadUserInfo}}" class="masking-out" catchtouchmove="ture">
  <image class="masking-img" src="{{KrImgUrl}}helpingActivity/index/prompt.png"></image>
</view>